<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCL - Mon Compte</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="Lcl_logo.svg.png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes bounce-in {
            0% { transform: translate(-50%, -100%); opacity: 0; }
            70% { transform: translate(-50%, 20px); opacity: 1; }
            100% { transform: translate(-50%, 0); opacity: 1; }
        }
        .animate-push { animation: bounce-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        .gold-card {
            background: linear-gradient(135deg, #BF953F 0%, #FCF6BA 45%, #B38728 70%, #FBF5B7 85%, #AA8B24 100%);
            border: 1px solid #D4AF37;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .gold-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(30deg);
            pointer-events: none;
        }

        .card-chip {
            width: 50px;
            height: 38px;
            border-radius: 8px;
            background: linear-gradient(135deg, #e2e2e2 0%, #999999 100%);
            position: relative;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .embossed-text {
            font-family: 'Courier New', Courier, monospace;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.4), -1px -1px 0px rgba(0,0,0,0.2);
            letter-spacing: 2px;
            font-weight: 900;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div id="app">
        <!-- Spinner affiché brièvement avant le rendu -->
        <div class="flex items-center justify-center min-h-screen">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-[#00205B]"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // CONFIGURATION ET ÉTAT
        let state = {
            isAuthenticated: false,
            user: null,
            balance: 1850750,
            isBalanceVisible: true,
            transactions: [
                { id: '1', label: 'VIREMENT RECU', amount: 1800000, date: '18/01/2026', type: 'credit', status: 'completed' },
                { id: '2', label: 'SUPERMARCHE CARREFOUR', amount: -145.20, date: '17/01/2026', type: 'debit', status: 'completed' },
                { id: '3', label: 'FACTURE EDF', amount: -89.00, date: '16/01/2026', type: 'debit', status: 'completed' },
                { id: '4', label: 'UBER RIDE', amount: -24.50, date: '16/01/2026', type: 'debit', status: 'completed' },
                { id: '5', label: 'FRAIS D\'ENTRETIEN COMPTE', amount: -12.00, date: '01/01/2026', type: 'debit', status: 'completed' }
            ],
            notifications: [],
            activeTab: 'courant'
        };

        const render = () => {
            const root = document.getElementById('app');
            if (!root) return;
            
            if (!state.isAuthenticated) {
                root.innerHTML = loginPage();
            } else {
                root.innerHTML = dashboardPage();
            }
            
            if (window.lucide) {
                lucide.createIcons();
            }
        };

        // UI COMPONENTS
        const loginPage = () => `
            <div class="min-h-screen bg-[#00205B] flex flex-col items-center justify-center p-4">
                <div class="w-full max-w-md bg-white rounded-3xl shadow-2xl p-10">
                    <h1 class="text-7xl font-black text-[#FFD700] text-center mb-10 italic tracking-tighter">LCL</h1>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-1">Identifiant</label>
                            <input type="text" id="loginId" class="w-full px-5 py-4 rounded-2xl border border-gray-200 focus:ring-2 focus:ring-[#00205B] outline-none transition-all text-lg" placeholder="Votre identifiant">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-1">Mot de passe</label>
                            <input type="password" id="loginPass" class="w-full px-5 py-4 rounded-2xl border border-gray-200 focus:ring-2 focus:ring-[#00205B] outline-none transition-all text-lg" placeholder="••••••">
                        </div>
                        <p id="loginError" class="text-red-500 text-sm text-center hidden">Identifiants incorrects</p>
                        <button onclick="handleLogin()" class="w-full bg-[#00205B] text-white py-5 rounded-2xl font-black text-lg hover:bg-[#001540] shadow-xl transition-all active:scale-95">
                            Accéder à mes comptes
                        </button>
                    </div>
                </div>
            </div>
        `;

        const dashboardPage = () => `
            <div class="flex flex-col min-h-screen bg-white relative">
                <div class="bg-[#00205B] text-white pt-14 pb-10 px-6 rounded-b-[45px] shadow-2xl z-10">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <h1 class="text-3xl font-black italic text-[#FFD700] tracking-tighter">LCL</h1>
                            <p class="text-sm opacity-60 mt-1 font-medium">Bonjour, Tremblay veronique</p>
                        </div>
                        <button onclick="logout()" class="p-3 bg-white/10 rounded-full hover:bg-white/20 transition-all">
                            <i data-lucide="log-out" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="flex gap-4 overflow-x-auto pb-4 mb-10 no-scrollbar">
                        ${['courant', 'epargne', 'credit', 'assurance'].map(id => `
                            <button onclick="setTab('${id}')" class="whitespace-nowrap px-6 py-2.5 rounded-full text-sm font-bold transition-all ${state.activeTab === id ? 'bg-white text-[#00205B]' : 'bg-white/10 text-white hover:bg-white/20'}">
                                ${id.charAt(0).toUpperCase() + id.slice(1)}
                            </button>
                        `).join('')}
                    </div>
                    <div class="text-center">
                        <div class="flex items-center justify-center gap-2 mb-2 opacity-60 uppercase text-[10px] font-black tracking-[0.2em]">
                            <span>${state.activeTab === 'courant' ? 'Solde disponible' : state.activeTab === 'epargne' ? 'Épargne totale' : state.activeTab === 'credit' ? 'Encours total' : 'Mes contrats'}</span>
                            <button onclick="toggleBalance()">${state.isBalanceVisible ? '<i data-lucide="eye-off" class="w-4 h-4"></i>' : '<i data-lucide="eye" class="w-4 h-4"></i>'}</button>
                        </div>
                        <div class="text-5xl font-black mb-6 tracking-tight">
                            ${state.isBalanceVisible ? 
                                (state.activeTab === 'courant' ? state.balance.toLocaleString('fr-FR') + ' €' : 
                                 state.activeTab === 'epargne' ? "520 000,00 €" : 
                                 state.activeTab === 'credit' ? "215 400,00 €" : "3 actifs")
                                : '••••••'}
                        </div>
                        <p class="text-[10px] opacity-40 font-bold uppercase tracking-widest">${new Date().toLocaleDateString('fr-FR')}</p>
                    </div>
                </div>

                <div class="flex-1 px-6 pt-10 pb-32">
                    ${state.activeTab === 'courant' ? `
                        <h2 class="text-2xl font-black text-[#00205B] mb-8">Opérations</h2>
                        <div class="space-y-8">
                            ${state.transactions.map(tx => `
                                <div class="flex justify-between items-start">
                                    <div class="flex gap-5">
                                        <div class="p-4 rounded-[22px] ${tx.amount > 0 ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-600'}">
                                            <i data-lucide="arrow-right-left"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-gray-900 text-lg">${tx.label}</h3>
                                            <p class="text-xs text-gray-400 mt-1 font-semibold">${tx.date}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        ${tx.status === 'pending' ? '<span class="block text-[10px] font-black text-red-500 uppercase mb-1 animate-pulse">En Attente</span>' : ''}
                                        <span class="text-xl font-black ${tx.amount > 0 ? 'text-green-600' : 'text-gray-900'}">
                                            ${tx.amount > 0 ? '+' : ''}${tx.amount.toLocaleString('fr-FR')} €
                                        </span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : state.activeTab === 'epargne' ? `
                        <h2 class="text-2xl font-black text-[#00205B] mb-8">Mes livrets</h2>
                        <div class="space-y-4">
                            <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex justify-between items-center">
                                <div><p class="text-xs font-bold text-gray-400 uppercase">Livret A</p><h3 class="text-lg font-black text-[#00205B]">Épargne Précaution</h3></div>
                                <p class="text-xl font-black text-[#00205B]">22 950,00 €</p>
                            </div>
                            <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex justify-between items-center">
                                <div><p class="text-xs font-bold text-gray-400 uppercase">PEL</p><h3 class="text-lg font-black text-[#00205B]">Plan Épargne Logement</h3></div>
                                <p class="text-xl font-black text-[#00205B]">497 050,00 €</p>
                            </div>
                        </div>
                    ` : state.activeTab === 'credit' ? `
                        <h2 class="text-2xl font-black text-[#00205B] mb-8">Mes crédits</h2>
                        <div class="space-y-4">
                            <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex justify-between items-center">
                                <div><p class="text-xs font-bold text-gray-400 uppercase">Immobilier</p><h3 class="text-lg font-black text-[#00205B]">Résidence Principale</h3></div>
                                <p class="text-xl font-black text-red-600">- 210 000,00 €</p>
                            </div>
                            <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex justify-between items-center">
                                <div><p class="text-xs font-bold text-gray-400 uppercase">Personnel</p><h3 class="text-lg font-black text-[#00205B]">Prêt Travaux</h3></div>
                                <p class="text-xl font-black text-red-600">- 5 400,00 €</p>
                            </div>
                        </div>
                    ` : `
                        <h2 class="text-2xl font-black text-[#00205B] mb-8">Mes contrats</h2>
                        <div class="space-y-4">
                            <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex items-center gap-4">
                                <div class="bg-blue-50 p-3 rounded-2xl text-[#00205B]"><i data-lucide="shield-check"></i></div>
                                <div><h3 class="text-lg font-black text-[#00205B]">Assurance Habitation</h3><p class="text-xs font-bold text-green-600 uppercase tracking-tighter">Formule Intégrale</p></div>
                            </div>
                            <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex items-center gap-4">
                                <div class="bg-blue-50 p-3 rounded-2xl text-[#00205B]"><i data-lucide="shield-check"></i></div>
                                <div><h3 class="text-lg font-black text-[#00205B]">Assurance Auto</h3><p class="text-xs font-bold text-green-600 uppercase tracking-tighter">Protection Visa</p></div>
                            </div>
                        </div>
                    `}
                </div>

                <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl border-t border-gray-100 px-8 py-5 z-20">
                    <div class="flex justify-around items-center max-w-md mx-auto">
                        <button onclick="openVirement()" class="flex flex-col items-center gap-1.5">
                            <div class="p-3.5 bg-[#00205B]/5 rounded-2xl text-[#00205B]"><i data-lucide="arrow-right-left"></i></div>
                            <span class="text-[10px] font-black text-[#00205B] uppercase">Virement</span>
                        </button>
                        <button onclick="openCard()" class="flex flex-col items-center gap-1.5">
                            <div class="p-3.5 rounded-2xl text-gray-400"><i data-lucide="credit-card"></i></div>
                            <span class="text-[10px] font-black text-gray-400 uppercase">Carte</span>
                        </button>
                        <button onclick="openNotifs()" class="flex flex-col items-center gap-1.5 relative">
                            <div class="p-3.5 rounded-2xl text-gray-400">
                                <i data-lucide="bell"></i>
                                ${state.notifications.length > 0 ? '<span class="absolute top-3 right-3 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>' : ''}
                            </div>
                            <span class="text-[10px] font-black text-gray-400 uppercase">Alertes</span>
                        </button>
                    </div>
                </div>
                <div id="overlay-container"></div>
            </div>
        `;

        const virementModal = () => `
            <div class="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4">
                <div class="bg-white w-full max-w-lg rounded-t-[45px] sm:rounded-[45px] p-10 shadow-2xl">
                    <div class="flex justify-between items-center mb-10">
                        <h2 class="text-3xl font-black text-[#00205B]">Virement</h2>
                        <button onclick="closeOverlay()" class="bg-gray-100 p-2.5 rounded-full">✕</button>
                    </div>
                    <form onsubmit="handleTransfer(event)" class="space-y-5">
                        <input required name="recipient" class="w-full bg-gray-50 rounded-2xl p-5 outline-none" placeholder="Bénéficiaire">
                        <input required name="iban" class="w-full bg-gray-50 rounded-2xl p-5 outline-none font-mono" placeholder="FR76...">
                        <input required name="amount" type="number" step="0.01" class="w-full bg-gray-50 rounded-2xl p-5 outline-none font-black text-xl" placeholder="Montant €">
                        <button id="transferBtn" type="submit" class="w-full bg-[#00205B] text-white py-6 rounded-2xl font-black text-xl shadow-xl">
                            Confirmer
                        </button>
                    </form>
                </div>
            </div>
        `;

        const notificationModal = () => `
            <div class="fixed inset-0 bg-white z-[150] flex flex-col">
                <div class="pt-14 pb-6 px-8 border-b border-gray-100 flex justify-between items-center">
                    <h2 class="text-3xl font-black text-[#00205B]">Alertes</h2>
                    <button onclick="closeOverlay()" class="text-[#00205B] font-bold">Fermer</button>
                </div>
                <div class="flex-1 overflow-y-auto p-8 space-y-6">
                    ${state.notifications.length === 0 ? '<p class="text-center opacity-20 py-20 font-bold">Aucune alerte</p>' : state.notifications.map(n => `
                        <div class="bg-gray-50 p-6 rounded-[35px] border-l-4 border-[#00205B]">
                            <h3 class="font-black text-[#00205B] uppercase text-xs">${n.title}</h3>
                            <p class="text-gray-700 mt-2 text-sm">${n.message}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;

        const cardModal = () => `
            <div class="fixed inset-0 bg-[#00205B]/95 backdrop-blur-xl z-[110] flex flex-col items-center justify-center p-8">
                <button onclick="closeOverlay()" class="absolute top-12 right-12 text-white text-4xl">✕</button>
                <div class="w-full max-w-sm aspect-[1.58/1] rounded-[22px] p-8 relative overflow-hidden gold-card">
                    <div class="flex justify-between items-start relative z-10 mb-8">
                        <span class="text-3xl font-black text-[#00205B] italic tracking-tighter">LCL</span>
                        <i data-lucide="wifi" class="text-[#00205B]/40 rotate-90 w-8 h-8"></i>
                    </div>
                    <div class="card-chip mb-8"></div>
                    <p class="text-2xl font-mono text-[#00205B] tracking-[0.1em] mb-4 font-black flex gap-4">
                        <span>4500</span> <span>8271</span> <span>9902</span> <span class="opacity-60">••••</span>
                    </p>
                    <p class="text-xl text-[#00205B] uppercase embossed-text mb-4">Tremblay veronique</p>
                    <div class="flex justify-between items-end relative z-10">
                        <div class="text-left">
                             <p class="text-[8px] text-[#00205B]/60 uppercase font-black tracking-widest">Expire fin</p>
                             <p class="text-lg text-[#00205B] font-black">12/28</p>
                        </div>
                        <div class="pb-1 pr-1"><span class="text-[#00205B] font-black italic text-3xl">VISA</span></div>
                    </div>
                </div>
                <div class="mt-16 text-center text-white/90 space-y-6">
                    <p class="text-3xl font-black text-[#FFD700]">Visa Premier</p>
                    <div class="flex gap-4 justify-center">
                        <button class="px-10 py-4 bg-white/10 rounded-2xl border border-white/20 font-black">Bloquer</button>
                        <button class="px-10 py-4 bg-white text-[#00205B] rounded-2xl font-black shadow-2xl">Voir code</button>
                    </div>
                </div>
            </div>
        `;

        // LOGIQUE APP
        window.handleLogin = () => {
            const id = document.getElementById('loginId').value;
            const pass = document.getElementById('loginPass').value;
            if (id === '85213647' && pass === '456123') {
                state.isAuthenticated = true;
                render();
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        };

        window.logout = () => { state.isAuthenticated = false; render(); };
        window.toggleBalance = () => { state.isBalanceVisible = !state.isBalanceVisible; render(); };
        window.setTab = (tab) => { state.activeTab = tab; render(); };
        window.closeOverlay = () => { document.getElementById('overlay-container').innerHTML = ''; };
        window.openCard = () => { document.getElementById('overlay-container').innerHTML = cardModal(); lucide.createIcons(); };
        window.openVirement = () => { document.getElementById('overlay-container').innerHTML = virementModal(); lucide.createIcons(); };
        window.openNotifs = () => { document.getElementById('overlay-container').innerHTML = notificationModal(); lucide.createIcons(); };

        window.handleTransfer = (e) => {
            e.preventDefault();
            const btn = document.getElementById('transferBtn');
            const form = e.target;
            btn.disabled = true;
            btn.innerHTML = 'Traitement...';
            
            setTimeout(() => {
                closeOverlay();
                const msg = "Pour un contrôle de conformité les fonds de ce compte ont été gelés en attendant la justification des fonds. Veuillez contacter votre gestionnaire.";
                
                const newTx = { id: Date.now().toString(), label: form.recipient.value, amount: -parseFloat(form.amount.value), date: new Date().toLocaleDateString('fr-FR'), type: 'debit', status: 'pending' };
                state.transactions = [newTx, ...state.transactions];
                state.notifications = [{ title: "CONTRÔLE", message: msg, date: new Date().toLocaleDateString('fr-FR') }, ...state.notifications];
                
                render();
                // Notification visuelle
                const div = document.createElement('div');
                div.innerHTML = `<div class="fixed top-6 left-1/2 transform -translate-x-1/2 z-[200] w-[90%] bg-white p-5 rounded-3xl shadow-2xl border border-gray-100 flex gap-4 animate-push">
                    <div class="bg-blue-600 p-2 rounded-xl text-white">i</div>
                    <div class="text-xs text-gray-700">${msg}</div>
                </div>`;
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 6000);
            }, 3000);
        };

        // INITIALISATION FIREBASE & MODE DÉMO
        let db = null;
        let auth = null;
        let appId = 'lcl-fictif-web';

        const init = async () => {
            render(); // Rendu immédiat (Login Page)

            try {
                if (typeof __firebase_config !== 'undefined') {
                    const firebaseConfig = JSON.parse(__firebase_config);
                    appId = typeof __app_id !== 'undefined' ? __app_id : appId;
                    const app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);

                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }

                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            state.user = user;
                            const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'account', 'data');
                            onSnapshot(docRef, (snap) => {
                                if (snap.exists()) {
                                    const data = snap.data();
                                    state.balance = data.balance ?? state.balance;
                                    state.transactions = data.transactions ?? state.transactions;
                                    state.notifications = data.notifications ?? state.notifications;
                                    render();
                                }
                            });
                        }
                    });
                }
            } catch (e) {
                console.warn("Mode Démo activé (Firebase absent ou non configuré).");
            }
        };

        init();
    </script>
</body>
</html>
